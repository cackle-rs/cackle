[common]
version = 1
features = [
    "crash-if-not-sandboxed",
    "foo",
]
import_std = [
    "fs",
    "env",
    "net",
    "process",
    "unix_sockets",
    "terminate",
]

[sandbox]
kind = "Bubblewrap"

# Restrict access to an entire crate.
[api.res1]
include = [
    "res_1",
]

[api.fs]
no_auto_detect = [
    "crab-3",
]

[api.restrict1]
include = [
    "crab_1::restrict1",
]

[api.terminate]
include = [
    "crab-3::terminate",
]

[pkg.crab-1]
allow_unsafe = true
import = [
    "fs",
]
allow_apis = [
    # Don't include fs permission.
    "env",
    "terminate",
    "unix_sockets",
]

[pkg.crab-1.build]
allow_apis = [
    "net",
]

[pkg.crab-2]
allow_apis = [
    "env",
    "fs",
]

[pkg.crab-2.build]
allow_apis = [
    "process",
    "env",
    "fs",
]
allow_build_instructions = [
    "cargo:rustc-link-*"
]
allow_unsafe = true

[pkg.crab-3]
allow_unsafe = true
allow_apis = [
    "process",
    "restrict1",
    "terminate",
    # Code in a file that's generated by build.rs.
    "env",
    "crab-1::fs",
]

[pkg.crab-3.build]
allow_apis = [
    "env",
    "fs",
]

[pkg.pmacro-1]
allow_apis = [
    "env",
]
allow_proc_macro = true

[pkg.crab-bin]
allow_apis = [
    "env",
    "fs",
    "res1",
]
allow_unsafe = true

[pkg.crab-bin.build]
sandbox.kind = "Disabled"
allow_apis = [
    "fs",
]

[pkg.crab-4]
allow_apis = [
    "env",
    "fs",
    "process",
]
allow_unsafe = true

[pkg.crab-4.build]
allow_apis = [
    "env",
    "fs",
]

[pkg.crab-5]
allow_apis = [
    "fs",
]

[pkg.shared-1]
allow_unsafe = true
allow_apis = [
    "crab-1::fs",
    "env",
]

[pkg.crab-7]
allow_unsafe = true
allow_apis = [
    "fs",
]

[pkg.crab-8]
allow_apis = [
    "fs",
]

[pkg.crab-9]
allow_apis = [
    "env",
    "fs",
    "process",
]
test.sandbox.bind_writable = [
    "crab-9/scratch"
]

[pkg.crab-10]
allow_unsafe = true

[pkg.crab-10.build]
allow_unsafe = true
allow_apis = [
    "env",
    "fs",
    "process",
]
allow_build_instructions = [
    "cargo:rustc-link-*",
]

[pkg.crab-11]
allow_apis = [
    "fs",
]

[pkg.crab-11.test]
sandbox.kind = "Disabled"
allow_apis = [
    "env",
    "terminate",
]

[pkg.crab-1.build.sandbox]
allow_network = true

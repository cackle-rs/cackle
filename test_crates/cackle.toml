[common]
version = 1
features = [
    "crash-if-not-sandboxed",
    "foo",
]
import_std = [
    "fs",
    "env",
    "net",
    "process",
    "unix_sockets",
    "terminate",
]

[sandbox]
kind = "Bubblewrap"

# Restrict access to an entire crate.
[api.res1]
include = [
    "res1",
]

[api.fs]
no_auto_detect = [
    "crab3",
]

[api.restrict1]
include = [
    "crab1::restrict1",
]

[api.terminate]
include = [
    "crab3::terminate",
]

[pkg.crab1]
allow_unsafe = true
import = [
    "fs",
]
allow_apis = [
    # Don't include fs permission.
    "env",
    "terminate",
    "unix_sockets",
]

[pkg.crab1.build]
allow_apis = [
    "net",
]

[pkg.crab2]
allow_apis = [
    "env",
    "fs",
]

[pkg.crab2.build]
allow_apis = [
    "process",
    "env",
    "fs",
]
allow_build_instructions = [
    "cargo:rustc-link-*"
]
allow_unsafe = true

[pkg.crab3]
allow_unsafe = true
allow_apis = [
    "process",
    "restrict1",
    "terminate",
    # Code in a file that's generated by build.rs.
    "env",
    "crab1::fs",
]

[pkg.crab3.build]
allow_apis = [
    "env",
    "fs",
]

[pkg.pmacro1]
allow_apis = [
    "env",
]
allow_proc_macro = true

[pkg.crab-bin]
allow_apis = [
    "env",
    "fs",
    "res1",
]
allow_unsafe = true

[pkg.crab-bin.build]
sandbox.kind = "Disabled"
allow_apis = [
    "fs",
]

[pkg.crab4]
allow_apis = [
    "env",
    "fs",
    "process",
]
allow_unsafe = true

[pkg.crab4.build]
allow_apis = [
    "env",
]

[pkg.crab5]
allow_apis = [
    "fs",
]

[pkg.shared1]
allow_unsafe = true
allow_apis = [
    "crab1::fs",
    "env",
]

[pkg.crab7]
allow_unsafe = true
allow_apis = [
    "fs",
]

[pkg.crab8]
allow_apis = [
    "fs",
]

[pkg.crab9]
allow_apis = [
    "env",
    "fs",
    "process",
]
sandbox.bind_writable = [
    "crab9/scratch"
]

[pkg.crab10]
allow_unsafe = true

[pkg.crab10.build]
allow_unsafe = true
allow_apis = [
    "env",
    "fs",
    "process",
]
allow_build_instructions = [
    "cargo:rustc-link-*",
]

[pkg.crab11]
allow_apis = [
    "fs",
]
sandbox.kind = "Disabled"

[pkg.crab1.build.sandbox]
allow_network = true

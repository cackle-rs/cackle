version = 1

[sandbox]
kind = "Bubblewrap"
allow_read = [
    "/usr"
]

[api.fs]
include = [
    "std::fs",
    "std::path",
    "std::io",
    "std::os::linux::fs",
    "std::os::unix::fs",
    "std::os::unix::io",
    "std::os::wasi::fs",
    "std::os::wasi::io",
    "std::os::windows::fs",
    "std::os::windows::io",
    # std::env provides quite a few functions that return paths, which can in
    # turn allow filesystem access.
    "std::env",
]
exclude = [
    "std::io::stdio",
    "std::env::var",
    "std::env::var_os",
    "std::env::vars",
    "std::env::vars_os",
    "std::env::args",
]

[api.env]
include = ["std::env"]

[api.net]
include = [
    "std::net",
    "std::os::unix::net",
    "std::os::wasi::net",
    "std::os::windows::net",
]

[api.process]
include = [
    "std::process",
    "std::unix::process",
    "std::windows::process",
]
exclude = [
    "std::process::abort",
    "std::process::exit",
]

[api.terminate]
include = [
    "std::process::abort",
    "std::process::exit",
]

[pkg.crab1]
allow_unsafe = true

[pkg.crab2]
allow_apis = [
    "fs",
]

[pkg.crab2.build]
allow_apis = [
    "process",
    "env",
    "fs",
]
allow_build_instructions = [
    "cargo:rustc-link-*"
]

[pkg.crab3]
# We can't currently identify this usage
#allow_unsafe = true
allow_apis = [
    "terminate",
    # Code in a file that's generated by build.rs.
    "env",
]

[pkg.crab3.build]
allow_apis = [
    "env",
    "fs",
]

[pkg.pmacro1]
allow_proc_macro = true
allow_apis = [
    "env"
]

[pkg.crab-bin]
allow_apis = [
    "fs",
]
